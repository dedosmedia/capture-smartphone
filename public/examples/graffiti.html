<!DOCTYPE html>
<html>
<head>
	<title>Example: Paint</title>
</head>
<body>

	<canvas height=768 width=1024></canvas>
	<script src="/javascripts/lib/require.2.1.1.js"></script>
	<script>
	requirejs.config({
	  baseUrl:'/javascripts',
	  paths:{
	    socketio:'/socket.io/socket.io',
	    ws:'helpers/ws',
	    event2socket:'helpers/event2socket'
	  },
	  shim:{
	    'ws':['socketio']
	  }
	});

	require([
	  'helpers/socket2event', 
	  'ws'
		], function(devices, ws){
			var c=document.querySelector('canvas'), ctx=c.getContext('2d');
			
			function putCircle(o){
				ctx.fillStyle = o.color;
				ctx.beginPath();
				ctx.arc(o.x, o.y, 10, 0, Math.PI*2, true);
				ctx.closePath();
				ctx.fill();
			}
			
			var painters={}; // 1D list of id:s generated using device_id+finger_id
			console.log('lll');
			ws.on('client connected', function(e){
				console.log('client connected');
			});
			
			devices.addEventListener('touchstart', function(e){
				var t, o;
		    for(var i=0; i<e.targetTouches.length; i++){
					t=e.targetTouches[i];
					o={x:t.clientX,y:t.clientY,color:e.color};
					// todo
					//painters[e.id+'_'+i]={x:t.clientX,y:t.clientY,color:e.color};
					putCircle(o);
		    }
		  });
		  devices.addEventListener('touchmove', function(e){
				var t;
		    for(var i=0; i<e.targetTouches.length; i++){
					t=e.targetTouches[i];
					o={x:t.clientX,y:t.clientY,color:e.color};
					putCircle(o);
		    }
		  });
		  devices.addEventListener('touchend', function(e){
		    console.log('tap');
		  });
			
			ws.emit('join','displays');
		});
	
	</script>
</body>
</html>