<!DOCTYPE html>
<html>
<head>
	<title>Example: Paint</title>
</head>
<body>

	<canvas height=768 width=1024></canvas>
	<script src="/javascripts/lib/require.2.1.1.js"></script>
	<script>
	requirejs.config({
	  baseUrl:'/javascripts',
	  paths:{
	    socketio:'/socket.io/socket.io',
	    ws:'helpers/ws',
	    event2socket:'helpers/event2socket'
	  },
	  shim:{
	    'ws':['socketio']
	  }
	});

	require([
	  'helpers/socket2event', 
	  'ws'
		], function(devices, ws){
			var c=document.querySelector('canvas'), ctx=c.getContext('2d');
			
			ctx.lineWidth=25;
			ctx.lineCap = 'round';

			function putCircle(coords, color){
				ctx.fillStyle = color;
				ctx.beginPath();
				ctx.arc(coords.x, coords.y, 10, 0, Math.PI*2, true);
				ctx.closePath();
				ctx.fill();
			}

			function line(from, to, color){
				ctx.strokeStyle = color;
				ctx.beginPath();
				ctx.moveTo(from.x, from.y)
				ctx.lineTo(to.x, to.y);
				ctx.stroke();
			}
			
			var painters={}; // 1D list of id:s generated using device_id+finger_id

			ws.on('client connected', function(e){
				console.log('client connected');
			});
			
			devices.addEventListener('touchstart', function(e){
				var t, o;
		    for(var i=0; i<e.targetTouches.length; i++){
					t=e.targetTouches[i];
					o={x:t.clientX,y:t.clientY};
					painters[e.id+'_'+i]=o;
					putCircle(o, e.color);
		    }
		  });
		  devices.addEventListener('touchmove', function(e){
				var t;
		    for(var i=0; i<e.targetTouches.length; i++){
					t=e.targetTouches[i];
					o={x:t.clientX,y:t.clientY};
					line(painters[e.id+'_'+i], o, e.color);
					painters[e.id+'_'+i]=o;
		    }
		  });
		  devices.addEventListener('touchend', function(e){
		  });
			
			ws.emit('join','displays');
		});
	
	</script>
</body>
</html>